/*! string2regex - v0.0.1 - 2014-10-21
* Copyright (c) 2014 ; Licensed  */
angular.module("string2regex",[]).value("String2RegexConfiguration",{groupColors:["#F5A9A9","#F3E2A9","#D0F5A9","#A9F5BC","#A9F5F2","#A9BCF5","#D0A9F5","#F5A9E1"],characterClassFunction:function(a){var b=[];return a>="0"&&"9">=a&&b.push("number"),a>="a"&&"z">=a&&b.push("lowercase"),a>="A"&&"Z">=a&&b.push("uppercase"),(_.contains(b,"lowercase")||_.contains(b,"uppercase"))&&b.push("alphabet"),(_.contains(b,"alphabet")||_.contains(b,"number"))&&b.push("alphanumerical"),b.push(" "===a?"space":"nonspace"),_.contains(b,"alphanumerical")||_.contains(b,"space")||b.push("symbol"),b.push("any"),b},generateRegex:function(a){return"number"===a?"[0-9]+":"lowercase"===a?"[a-z]+":"uppercase"===a?"[A-Z]+":"alphabet"===a?"[a-zA-Z]+":"alphanumerical"===a?"[a-zA-Z0-9]+":"space"===a?"\\s+":"nonspace"===a?"\\S+":"symbol"===a?"[^a-zA-Z0-9]+":"any"===a?".+":"ERROR unknown charClass "+a},defaultClass:"any"}).controller("String2RegexCtrl",["$scope","String2RegexConfiguration",function(a,b){function c(a){for(var b=k(a[0]),c=1;c<a.length;c++){var d=k(a[c]);b=_.intersection(d,b)}return b}function d(a,b){if(void 0===b&&(b=0),a.length<=1)return[];for(var d=[],f=c(a),g=_.difference(k(a[0]),f),h=0,i="",j=1;j<a.length;j++){var l=(a[j],_.difference(k(a[j]),f));0===_.intersection(l,g).length?(i=a.substring(h,j),d.push(e(i,b)),g=l,h=j):g=_.intersection(l,g)}return 0===h?(console.log("Apparently same group"),[]):(i=a.substring(h,a.length),d.push(e(i,b)),d)}function e(b,e){void 0===e&&(e=0);var i={picked:!1,string:b,getSize:function(){return this.string.length},getGroupColor:function(){return f(this.depth)},commonClass:c(b,e),depth:e,selectedClass:"",hasSelected:function(){if(""!==this.selectedClass)return!0;var a=_.find(this.childs,function(a){return a.hasSelected()});return void 0!==a},ensureSelection:function(){_.any(this.childs,function(a){return a.hasSelected()})?(this.selectedClass="",_.each(this.childs,function(a){a.ensureSelection()})):""===this.selectedClass&&(this.selectedClass=l)},ensureNoSelection:function(){this.selectedClass="",_.each(this.childs,function(a){a.ensureNoSelection()})},select:function(b){this.ensureNoSelection(),this.selectedClass=b,a.rootGroup.ensureSelection(),g()},generateRegex:function(){var a="";return""===this.selectedClass?_.each(this.childs,function(b){a+=b.generateRegex()}):a+=m(this.selectedClass,this),a},preserveSettingFromOldGroup:function(a){function b(a,b){return _.intersection(a.commonClass,b.commonClass).length==a.commonClass.length}this.selectedClass=a.selectedClass;for(var c=h(a.childs,this.childs,b),d=0,e=0;e<this.childs.length&&!(d>=c.length);e++)b(this.childs[e],c[d])&&(this.childs[e].preserveSettingFromOldGroup(c[d]),d++)},childs:d(b,e+1)};return i}function f(a){return j[a%j.length]}function g(){a.holder.regex=a.rootGroup.generateRegex()}function h(a,b,c){var d,e,f=[],g=[],h=[];for(d=0;d<b.length;d++)h.push(0);for(d=0;d<a.length;d++)f.push(angular.copy(h)),g.push(angular.copy(h));for(d=0;d<a.length;d++)for(e=0;e<b.length;e++)0===d||0===e?c(a[d],b[e])?(f[d][e]=1,g[d][e]=1):0===d?g[d][e]=3:0===e&&(g[d][e]=2):c(a[d],b[e])?(f[d][e]=f[d-1][e-1]+1,g[d][e]=1):(f[d-1][e]>f[d][e]&&(f[d][e]=f[d-1][e],g[d][e]=2),f[d][e-1]>f[d][e]&&(f[d][e]=f[d][e-1],g[d][e]=3));var i=[];for(d=a.length-1,e=b.length-1;-1!=d&&-1!=e;){var j=g[d][e];if(1==j&&(i.push(a[d]),d--,e--),2==j&&d--,3==j&&e--,0===j)break}return i.reverse(),i}var i=a.holder,j=b.groupColors,k=b.characterClassFunction,l=b.defaultClass,m=b.generateRegex;a.$watch("holder.sample",function(){var b=a.rootGroup;a.rootGroup=e(i.sample),a.rootGroup.preserveSettingFromOldGroup(b),a.rootGroup.ensureSelection(),g()}),a.rootGroup=e(i.sample),a.rootGroup.ensureSelection(),g(),a.getCharacterClass=k,a.findLCS=h,a.getCommonCharacterClass=c,a.generateChildGroups=d,a.generateGroup=e,a.regenerateResult=g,a.getColorForDepth=f}]).directive("string2regex",function(){return{scope:{holder:"=string2regex"},controller:"String2RegexCtrl",link:function(){},templateUrl:"string2regex-template.html"}}).directive("string2regexGroup",["RecursionHelper",function(a){return{scope:{group:"=string2regexGroup"},link:function(){},compile:function(b){return a.compile(b)},templateUrl:"string2regex-template-group.html"}}]).factory("RecursionHelper",["$compile",function(a){return{compile:function(b,c){angular.isFunction(c)&&(c={post:c});var d,e=b.contents().remove();return{pre:c&&c.pre?c.pre:null,post:function(b,f){d||(d=a(e)),d(b,function(a){f.append(a)}),c&&c.post&&c.post.apply(null,arguments)}}}}}]);